
---

## üè† Hub de Controle IoT: Flask + ESP32 (Socket.IO)

Este projeto implementa um sistema de controle de dispositivos IoT em tempo real, utilizando **Flask** como servidor web/Hub de comunica√ß√£o e um **ESP32** como o dispositivo de campo para acionamento de rel√©s. A comunica√ß√£o bidirecional e de baixa lat√™ncia √© garantida pelo **Socket.IO**.

## üöÄ Tecnologias Utilizadas

| Componente      | Linguagem/Plataforma | Depend√™ncias Chave             | Fun√ß√£o Principal |
|------------------|----------------------|---------------------------------|------------------|
| **Hub/Backend**  | Python (Flask)       | ``Flask-SocketIO``, ``python-socketio`` | Servidor Web, gerenciamento de status (Online/Offline) e roteamento de comandos. |
| **Frontend/UI**  | JavaScript, HTML, CSS | ``Socket.IO Client``, Tailwind CSS  | Interface de usu√°rio responsiva e envio/recebimento de comandos em tempo real. |
| **Dispositivo**  | C++ (Arduino)        | ``WiFiManager``, ``SocketIOClient``     | Conex√£o Wi-Fi port√°til, recebimento de comandos e controle de GPIO (Rel√©s). |
---


üìê Arquitetura do Sistema
---
O sistema opera em uma arquitetura centralizada onde o servidor Flask atua como um broker de mensagens em tempo real:

1. **Conex√£o:** O ESP32 utiliza a biblioteca `WiFiManager` para se conectar √† rede. Em seguida, estabelece uma conex√£o persistente de **Socket.IO** com o Hub Flask.

2. **Status:** O Hub Flask monitora a conex√£o. Se o ESP32 estiver conectado, o status na interface web √© `Online`.

3. **Comando:** O usu√°rio na interface web clica em um bot√£o (`Ligar`/`Desligar`).

4. **Roteamento:** O navegador (cliente Socket.IO) envia o comando (`web_command`) para o Flask.

5. **A√ß√£o:** O Flask retransmite o comando diretamente para o ESP32 conectado.

6. **Feedback:** O ESP32 aciona o rel√© e pode opcionalmente enviar uma confirma√ß√£o de volta ao Flask, que a exibe no log da interface web.

## Fluxograma

![Logo do Projeto](./static/img/fluxograma.svg)

## üõ†Ô∏è Configura√ß√£o do Backend (Flask Hub)

### Pr√©-requisitos

+ Python 3.x
+ PIP (Gerenciador de Pacotes Python)

### Instala√ß√£o
Crie um ambiente virtual e instale as depend√™ncias:

```
# 1. Clonar o reposit√≥rio:
git clone <URL_DO_SEU_REPOSIT√ìRIO>
cd <nome-do-diretorio>

# 2. Criar e ativar o ambiente virtual (Exemplo Linux/macOS):
python -m venv venv

# 2.1. Se for Linux/macOS, use:
source venv/bin/activate

# 2.1. Se for Windows, use:
.\venv\Scripts\activate

# 3. Instalar depend√™ncias:
pip install -r requirements.txt
```
üí° Dica: O arquivo requirements.txt cont√©m todas as bibliotecas necess√°rias (como Flask, Flask-SocketIO, python-socketio, etc.), permitindo configurar o ambiente completo em um s√≥ comando.

## Estrutura de Arquivos
```
‚îú‚îÄ‚îÄ app.py              # Aplica√ß√£o Flask principal e l√≥gica Socket.IO
‚îú‚îÄ‚îÄ README.md           # Este arquivo
‚îú‚îÄ‚îÄ requirements.txt    # Lista de depend√™ncias Python
‚îî‚îÄ‚îÄ templates/
    ‚îî‚îÄ‚îÄ index.html      # Frontend HTML
    ‚îî‚îÄ‚îÄ login.html      # Tela de Login    
‚îî‚îÄ‚îÄ static/
    ‚îú‚îÄ‚îÄ app.js          # L√≥gica do Socket.IO e UI do cliente
    ‚îî‚îÄ‚îÄ styles.css      # Estilos customizados
```

## Execu√ß√£o

Para iniciar o servidor Flask:

```
python app.py
```

O Hub estar√° dispon√≠vel em http://127.0.0.1:5000 (ou na porta configurada).

## üíª Configura√ß√£o do Firmware (ESP32)

### Pr√©-requisitos
- Arduino IDE ou VS Code com extens√£o PlatformIO.
- Placa ESP32 configurada.

### Bibliotecas Necess√°rias

Instale as seguintes bibliotecas atrav√©s do Gerenciador de Bibliotecas da IDE:

1. **WiFiManager** (Recomendado: Vers√£o compat√≠vel com ESP32, ex: por tzapu ou Tabalabs)

2. **SocketIOClient** (Cliente Socket.IO para ESP32)

### Portabilidade Wi-Fi
---
O uso do ``WiFiManager`` garante a portabilidade. Na primeira execu√ß√£o, o ESP32 criar√° um Ponto de Acesso (AP) chamado ``ESP32_HUB_SETUP``.

1. Conecte-se a esse AP via celular ou computador.

2. Um portal de configura√ß√£o abrir√° automaticamente.

3. Selecione sua rede Wi-Fi local e insira a senha.

4. O ESP32 salvar√° as credenciais e reiniciar√°, conectando-se automaticamente.

### L√≥gica de Conex√£o
O firmware deve ser configurado para apontar para o IP do seu servidor Flask (ex: ``http://192.168.1.10:5000``) ap√≥s a conex√£o bem-sucedida do ``WiFiManager``.

Eventos Chave no ESP32:

| **Evento** | **Dire√ß√£o** | **Prop√≥sito** |
|----|----|----|
| ``connect`` | ESP32 -> Flask | Notifica o Hub que o dispositivo est√° online. |
| ``web_command`` | Flask -> ESP32 | Recebe o JSON de comando (``{"target": "lamp", "state": "on"}``). |
| ``status_update`` | ESP32 -> Flask | Opcional: Envia confirma√ß√£o de que o comando foi executado. |
