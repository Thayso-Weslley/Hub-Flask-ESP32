
---

## ğŸ  Hub de Controle IoT: Flask + ESP32 (Socket.IO)

Este projeto implementa um sistema de controle de dispositivos IoT em tempo real, utilizando **Flask** como servidor web/Hub de comunicaÃ§Ã£o e um **ESP32** como o dispositivo de campo para acionamento de relÃ©s. A comunicaÃ§Ã£o bidirecional e de baixa latÃªncia Ã© garantida pelo **Socket.IO**.

## ğŸš€ Tecnologias Utilizadas

| Componente      | Linguagem/Plataforma | DependÃªncias Chave             | FunÃ§Ã£o Principal |
|------------------|----------------------|---------------------------------|------------------|
| **Hub/Backend**  | Python (Flask)       | ``Flask-SocketIO``, ``python-socketio`` | Servidor Web, gerenciamento de status (Online/Offline) e roteamento de comandos. |
| **Frontend/UI**  | JavaScript, HTML, CSS | ``Socket.IO Client``, Tailwind CSS  | Interface de usuÃ¡rio responsiva e envio/recebimento de comandos em tempo real. |
| **Dispositivo**  | C++ (Arduino)        | ``WiFiManager``, ``SocketIOClient``     | ConexÃ£o Wi-Fi portÃ¡til, recebimento de comandos e controle de GPIO (RelÃ©s). |



## ğŸ“ Arquitetura do Sistema

O sistema opera em uma arquitetura centralizada onde o servidor Flask atua como um broker de mensagens em tempo real:

1. **ConexÃ£o:** O ESP32 utiliza a biblioteca `WiFiManager` para se conectar Ã  rede. Em seguida, estabelece uma conexÃ£o persistente de **Socket.IO** com o Hub Flask.

2. **Status:** O Hub Flask monitora a conexÃ£o, exibindo o status (`Online`/`Offline`) na interface.

3. **Comando/Roteamento:** O usuÃ¡rio clica na UI; o navegador envia o comando (`web_command`) ao Flask, que o retransmite ao ESP32.

4. **AÃ§Ã£o/Feedback:** O ESP32 aciona o relÃ©. Opcionalmente, pode enviar uma confirmaÃ§Ã£o de volta ao Flask.



## ğŸ“Š Fluxograma

![Logo do Projeto](./static/img/fluxograma.svg)

## ğŸ› ï¸ ConfiguraÃ§Ã£o do Backend (Flask Hub)

### PrÃ©-requisitos

+ Python 3.x
+ PIP (Gerenciador de Pacotes Python)
+ PlatformIO Core (CLI): Essencial para compilaÃ§Ã£o e upload do firmware ESP32

### 1. PreparaÃ§Ã£o do Ambiente
Clone o repositÃ³rio e configure as dependÃªncias (Python e PlatformIO):

### InstalaÃ§Ã£o
Crie um ambiente virtual e instale as dependÃªncias:

```
# 1. Clonar o repositÃ³rio:
git clone <URL_DO_SEU_REPOSITÃ“RIO>
cd <nome-do-diretorio>

# 2. Criar e ativar o ambiente virtual:
python -m venv venv
# Ative: source venv/bin/activate (Linux/macOS) ou .\venv\Scripts\activate (Windows)

# 3. Instalar dependÃªncias Python do WebHub:
pip install -r ./dependencias/requirements.txt

# 4. Instalar o PlatformIO Core (CLI):
pip install platformio

```
ğŸ’¡ Dica: O arquivo requirements.txt contÃ©m todas as bibliotecas necessÃ¡rias (como Flask, Flask-SocketIO, python-socketio, etc.), permitindo configurar o ambiente completo em um sÃ³ comando.

### 2. ExecuÃ§Ã£o do Backend (Hub Flask)

Com o ambiente virtual ativado, inicie o servidor Flask. O Hub estarÃ¡ disponÃ­vel em `http://127.0.0.1:5000`
```
python app.py
```


## ğŸ’» ConfiguraÃ§Ã£o do Firmware (ESP32)

### Procedimento de Upload
1. Conecte o ESP32 ao seu PC via cabo Micro-USB.

2. O arquivo platformio.ini gerencia automaticamente a plataforma e as dependÃªncias C++.

3. Execute o comando de build e upload no terminal (dentro da pasta raiz do projeto):

```
pio run -t upload
```
**AÃ§Ã£o do Comando:** Substitui a Arduino IDE, compilando o cÃ³digo C++ e gravando o binÃ¡rio na memÃ³ria Flash do ESP32.

### Portabilidade Wi-Fi (WiFiManager)

Na **primeira execuÃ§Ã£o**, o ESP32 cria um Ponto de Acesso (AP). Conecte-se a ele (`ESP32_HUB_SETUP`), configure o Wi-Fi e o Hub. O ESP32 salva as credenciais, reinicia e se conecta automaticamente.

| **Evento** | **DireÃ§Ã£o** | **PropÃ³sito** |
|----|----|----|
| ``connect`` | ESP32 -> Flask | Notifica o Hub que o dispositivo estÃ¡ online. |
| ``web_command`` | Flask -> ESP32 | Recebe o JSON de comando (``{"target": "lamp", "state": "on"}``). |
| ``status_update`` | ESP32 -> Flask | Opcional: Envia confirmaÃ§Ã£o de que o comando foi executado. |

## Estrutura de Arquivos
```
â”œâ”€â”€ Codigo_ESP32/Codigo_ESP32.ino    # CÃ³digo C++ do Firmware (ESP32)
â”œâ”€â”€ dependencias/
    â””â”€â”€ platformio.ini # ConfiguraÃ§Ã£o do build e dependÃªncias do ESP32
    â””â”€â”€ requirements.txt # Lista de dependÃªncias Python
â””â”€â”€ static/
    â”œâ”€â”€ js/main.js          # LÃ³gica do Socket.IO e UI do cliente  
    â”œâ”€â”€ img/fluxograma.svg  # Fluxograma deste projeto
    â””â”€â”€ css/styles.css      # Estilos customizados
â””â”€â”€ templates/
    â”œâ”€â”€ index.html      # Frontend HTML
    â””â”€â”€ login.html      # Tela de Login    
â”œâ”€â”€ app.py              # AplicaÃ§Ã£o Flask principal e lÃ³gica Socket.IO
â””â”€â”€ README.md           # Este arquivo
```

